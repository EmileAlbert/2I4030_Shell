<!DOCTYPE html>
<!-- saved from url=(0049)https://brennan.io/2015/01/16/write-a-shell-in-c/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Main/Important Meta -->
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorial - Write a Shell in C • Stephen Brennan</title>

  <!-- Icons -->
  <link rel="apple-touch-icon" href="https://brennan.io/images/me.jpg">
  <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href="https://brennan.io/favicon.ico">

  <!-- Styles -->
  <link rel="stylesheet" href="./Tutorial - Write a Shell in C • Stephen Brennan_files/normalize.css">
  <link rel="stylesheet" href="./Tutorial - Write a Shell in C • Stephen Brennan_files/main.css">
  <link rel="stylesheet" href="./Tutorial - Write a Shell in C • Stephen Brennan_files/solarized.css">
  <link href="./Tutorial - Write a Shell in C • Stephen Brennan_files/font-awesome.min.css" rel="stylesheet">
  <link href="./Tutorial - Write a Shell in C • Stephen Brennan_files/css" rel="stylesheet" type="text/css">
  <link rel="canonical" href="https://brennan.io/2015/01/16/write-a-shell-in-c/">

  <!-- Meta information -->
  <meta name="author" content="Stephen Brennan">
  <meta name="description" content="Stephen Brennan&#39;s personal website and blog.">
  <meta name="keywords" content="Linux Unix Tutorial C blog programming student resume technology talks">

  <!-- Open Graph tags (Facebook meta-info) -->
  <meta property="og:title" content="Tutorial - Write a Shell in C - Stephen Brennan">
  <meta property="og:url" content="https://brennan.io/2015/01/16/write-a-shell-in-c/">
  <meta property="og:image" content="https://brennan.io/images/me.jpg">
  <meta property="og:description" content="A tutorial on how to write a Unix shell in C.
">
  <meta property="og:site_name" content="Stephen Brennan&#39;s Blog">
  <meta property="og:see_also" content="https://brennan.io">

  <!-- Twitter meta-info -->
  <meta name="twitter:site" content="@brenns10">
  <meta name="twitter:creator" content="@brenns10">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://brennan.io/2015/01/16/write-a-shell-in-c/">
  <meta name="twitter:title" content="Tutorial - Write a Shell in C - Stephen Brennan">
  <meta name="twitter:description" content="A tutorial on how to write a Unix shell in C.
">
  <meta name="twitter:image" content="https://brennan.io/images/me.jpg">

  <!-- Various Javascript -->
  <script id="facebook-jssdk" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/sdk.js.téléchargé"></script><script async="" src="https://www.google-analytics.com/analytics.js"></script><script id="twitter-wjs" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/widgets.js.téléchargé"></script><script id="hn-button.js" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/hn-button.js.téléchargé"></script><script type="text/javascript">var HN=[];HN.factory=function(e){return function(){HN.push([e].concat(Array.prototype.slice.call(arguments,0)))};},HN.on=HN.factory("on"),HN.once=HN.factory("once"),HN.off=HN.factory("off"),HN.emit=HN.factory("emit"),HN.load=function(){var e="hn-button.js";if(document.getElementById(e))return;var t=document.createElement("script");t.id=e,t.src="//hn-button.herokuapp.com/hn-button.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},HN.load();</script>

  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58675248-2', 'auto');
  ga('send', 'pageview');
</script>

  <script src="./Tutorial - Write a Shell in C • Stephen Brennan_files/MathJax.js.téléchargé" id="">
</script>

<script src="./Tutorial - Write a Shell in C • Stephen Brennan_files/embed.js.téléchargé" data-timestamp="1513502498256"></script><style type="text/css">:root a[href^="http://188.165.178.248/"], :root a[href^="http://www.drowle.com/"], :root #header + #content > #left > #rlblock_left, :root #\5f _mom_ad_2, :root #rhs_block .mod > .luhb-div > div[data-async-type="updateHotelBookingModule"], :root a[href^="http://ads.wui.fr/"], :root #\5f _admvnlb_modal_container, :root a[href^="http://earn4ads.com/"], :root a[href^="http://keep2share.cc/pr/"], :root #MAIN.ShowTopic > .ad, :root #\5f _mom_ad_12, :root #center_col > #main > .dfrd > .mnr-c > .c._oc._zs, :root .__y_elastic .__y_item, :root div[id*="300x250_advertisement_"], :root a[href^="http://ul.to/ref/"], :root #\5f _nq__hh[style="display:block!important"], :root a[href^="http://ads.pheedo.com/"], :root a[href^="http://landingpagegenius.com/"], :root a[href^="http://hopinions.info/"], :root .inlineNewsletterSubscription + .inlineNewsletterSubscription div[class$="_item"], :root #ads > .dose > .dosesingle, :root a[href^="http://lp.ncdownloader.com/"], :root a[href^="http://www.getyourguide.com/?partner_id="], :root a[href^="http://media.paddypower.com/redirect.aspx?"], :root a[href^="http://www.adskeeper.co.uk/"], :root div[id^="adsatlas-"], :root #assetsListings[style="display: block;"], :root a[href^="http://b.bestcompleteusa.info/"], :root [class^="view-affichage-publicit"], :root #main-content > [style="padding:10px 0 0 0 !important;"], :root a[href^="https://www.spyoff.com/"], :root #center_col > #\5f Emc, :root .ob_container a[data-redirect^="http://paid.outbrain.com/network/redir?"], :root a[href^="http://easydownload4you.com/"], :root a[href^="http://secure.signup-way.com/"], :root #center_col > #res > #topstuff + #search > div > #ires > #rso > #flun, :root a[href^="http://cdn3.adexprts.com/"], :root a[href^="http://web.adblade.com/"], :root a[href^="http://www.affbuzzads.com/affiliate/"], :root #center_col > #resultStats + #tads, :root #center_col > #resultStats + #tads + #res + #tads, :root #cnt #center_col > #taw > #tvcap > .c._oc._Lp, :root a[href^="http://codec.codecm.com/"], :root #center_col > #resultStats + div + #res + #tads, :root a[href*="wow-partners.com/click.php"], :root #center_col > #resultStats + div[style="border:1px solid #dedede;margin-bottom:11px;padding:5px 7px 5px 6px"], :root a[href^="http://liversely.com/"], :root div[id^="div-gpt-ad"], :root #topstuff > #tads, :root a[href*="/rel/index.cfm?RST="], :root #center_col > #taw > #tvcap > .rscontainer, :root a[href^="http://www.bet365.com/"][href*="?affiliate="], :root #center_col > div[style="font-size:14px;margin-right:0;min-height:5px"] > div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff8e7"], :root a[href^="http://fileloadr.com/"], :root .gbfwa > div[class$="_item"], :root a[href^="http://www.friendlyadvertisements.com/"], :root div[id^="ad_script_"], :root #cnt #center_col > #res > #topstuff > .ts, :root #mn div[style="position:relative"] > #center_col > ._Ak, :root a[href^="http://affiliates.pinnaclesports.com/processing/"], :root a[href^=".php/annonce/ads/"], :root a[href*="=INSERT_RANDOM_NUMBER_HERE&"], :root [id^="bunyad_ads_widget-"], :root #content > #center > .dose > .dosesingle, :root [class*="proadszoneholder-"], :root #content > #right > .dose > .dosesingle, :root [id*="/adunblock_"] > iframe, :root a[href^="http://buysellads.com/"], :root a[href^="http://fsoft4down.com/"], :root #flowplayer > div[style="position: absolute; width: 300px; height: 275px; left: 222.5px; top: 85px; z-index: 999;"], :root #mn #center_col > div > h2.spon:first-child + ol:last-child, :root a[href^="http://www.easydownloadnow.com/"], :root a[href*="emprestimo.eu"], :root a[href^="http://n217adserv.com/"], :root #flowplayer > div[style="z-index: 208; position: absolute; width: 300px; height: 275px; left: 222.5px; top: 85px;"], :root div[id^="ads120_600-widget"], :root .rc-cta[data-target], :root a[href*="//afftrack001.com/"], :root a[href^="http://c.ketads.com/"], :root .GB3L-QEDGY .GB3L-QEDF- > .GB3L-QEDE-, :root a[href*="regie.medncom.com/"], :root #main_col > #center_col div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff7ed"], :root a[href^="http://www.usearchmedia.com/signup?"], :root .__zinit .__y_item, :root a[href^="http://banners.victor.com/processing/"], :root #mbEnd[cellspacing="0"][cellpadding="0"], :root a[href^="http://ads.sprintrade.com/"], :root a[href^="http://fr.tuto.com/?aff="] > img, :root #mn #center_col > div > h2.spon:first-child, :root a[href^="http://ad-online.biz/"], :root #rhs_block > .ts[cellspacing="0"][cellpadding="0"][style="padding:0"], :root a[href^="http://farm.plista.com/pets"], :root .__yinit .__y_item, :root #mn div[style="position:relative"] > #center_col > div > ._dPg, :root a[href*="://go.nordvpn.net/aff_"] > img, :root div[class^="block-openx-"], :root a[href*="://aclick.adhoc4.net/"], :root #resultspanel > #topads, :root a[href^="https://www.firstload.com/affiliate/"], :root #rhs_block > #mbEnd, :root a[href^="http://www.faceporn.net/free?"], :root a[href*="://code.tubeadvertising.eu/"], :root [id*="ScrollDownAds"], :root a[href^="http://uploaded.net/ref/"], :root #rhs_block .mod > .gws-local-hotels__booking-module, :root a[href^="annonceur.php?id_banniere="], :root a[href^="http://jobitem.org/"], :root a[href^="http://www.fbooksluts.com/"], :root #rhs_block .xpdopen > ._OKe > div > .mod > ._yYf, :root #rhs_block > ol > .rhsvw > .kp-blk > .xpdopen > ._OKe > ol > ._DJe > .luhb-div, :root a[href^="http://www.moneyducks.com/"], :root .trc_rbox_div .syndicatedItem, :root a[href^="http://websitedhoome.com/"], :root .mw > #rcnt > #center_col > #taw > #tvcap > .c, :root a[href^="http://ad.yieldmanager.com/"], :root div[class^="ad-inside-post-"], :root .lads[width="100%"][style="background:#FFF8DD"], :root a[href^="http://taboola-"][href*="/redirect.php?app.type="], :root #rhs_block > script + .c._oc._Ve.rhsvw, :root #tads + div + .c, :root a[href^="http://www.uniblue.com/cm/"], :root #rhswrapper > #rhssection[border="0"][bgcolor="#ffffff"], :root a[href^="http://ads.betfair.com/redirect.aspx?"], :root #ssmiwdiv[jsdisplay], :root a[href^="http://adserver.itsfogo.com/"], :root .__ywl .__y_item, :root .GFYY1SVD2 > .GFYY1SVC2 > .GFYY1SVF5, :root a[href^="http://ads.activtrades.com/"], :root .GHOFUQ5BG2 > .GHOFUQ5BF2 > .GHOFUQ5BG5, :root div[id^="mainads"], :root .GFYY1SVE2 > .GFYY1SVD2 > .GFYY1SVG5, :root .jobs-information-call-to-action + .jobs-information-call-to-action div[class$="_item"], :root [id^="criteoDivPave"], :root .GJJKPX2N1 > .GJJKPX2M1 > .GJJKPX2P4, :root a[href^="http://clickandjoinyourgirl.com/"], :root a[href^="http://www.terraclicks.com/"], :root a[href^="http://go.oclaserver.com/"], :root a[href^="http://paid.outbrain.com/network/redir?"], :root .GKJYXHBF2 > .GKJYXHBE2 > .GKJYXHBH5, :root .GPMV2XEDA2 > .GPMV2XEDP1 > .GPMV2XEDJBB, :root a[href^="http://www.streamtunerhd.com/signup?"], :root .Mpopup + #Mad > #MadZone, :root .__y_inner > .__y_item, :root .__ywvr .__y_item, :root .ch[onclick="ga(this,event)"], :root a[href^="http://www.shglegle.com/"], :root a[href*="://ouo.io/ref/"], :root .icons-rss-feed + .icons-rss-feed div[class$="_item"], :root .l-container > #fishtank, :root a[href^="http://hyperlinksecure.com/go/"], :root a[href^="http://www.epicgameads.com/"], :root .mod > ._jH + .rscontainer, :root a[href*="://hilltopads.net/"], :root a[href*="://aclick.adhoc2.com/"], :root .mw > #rcnt > #center_col > #taw > .c, :root a[href^="http://clicks.binarypromos.com/"], :root a[href^="http://xads.zedo.com/"], :root .nrelate .nr_partner, :root .ob_container .item-container-obpd, :root a[href^="http://www.paddypower.com/?AFF_ID="], :root a[target="_blank"][href*="/buy-vpn?"] > img, :root .ob_dual_right > .ob_ads_header ~ .odb_div, :root a[href^="https://snapmrsexe.com/lp/"], :root a[href^="http://selfsrver.com/"], :root .plistaList > .itemLinkPET, :root a[href^="http://adtransfer.net/"], :root a[href^="http://bcp.crwdcntrl.net/"], :root .plistaList > .plista_widget_underArticle_item[data-type="pet"], :root a[href^="http://www.pinkvisualgames.com/?revid="], :root .plista_widget_belowArticleRelaunch_item[data-type="pet"], :root a[href^="http://abc2.mobile-10.com/"], :root .ra[align="left"][width="30%"], :root .ra[align="right"][width="30%"], :root .ra[width="30%"][align="right"] + table[width="70%"][cellpadding="0"], :root .rhsvw[style="background-color:#fff;margin:0 0 14px;padding-bottom:1px;padding-top:1px;"], :root .rscontainer > .ellip, :root a[href^="http://record.sportsbetaffiliates.com.au/"], :root a[href^="http://www.fducks.com/"], :root .section-result[data-result-ad-type], :root a[href^="http://cinema.friendscout24.de?"], :root .samBannerUnit .SamLink, :root a[href$="?id=728x90"][target="_blank"] > img, :root .trc_rbox .syndicatedItem, :root .trc_rbox_border_elm .syndicatedItem, :root .trc_rbox_div .syndicatedItemUB, :root .trc_rbox_div a[target="_blank"][href^="http://tab"], :root [class^="view-id-affichage_publicit"], :root .trc_related_container div[data-item-syndicated="true"], :root div[id^="sqweb_ad_control-"], :root a[href^="http://www.linkredirect.biz/"], :root .widget-pane-section-result[data-result-ad-type], :root a[href^="http://www.ringtonematcher.com/"], :root ADS-RIGHT, :root div[id^="div-adtech-ad-"], :root AFS-AD, :root div[id^="div_openx_ad_"], :root [onclick*="FriendlyDuck.com/AF_"], :root a[href^="//srv.buysellads.com/"], :root AMP-AD, :root a[href^="http://engine.newsmaxfeednetwork.com/"], :root [ad-id^="googlead"], :root [lazy-ad="lefttop_banner"], :root a[onmousedown^="this.href='http://staffpicks.outbrain.com/network/redir?"][target="_blank"] + .ob_source, :root [onclick*="content.ad/"], :root a[href^="http://pokershibes.com/index.php?ref="], :root [onclick^="window.open('http://adultfriendfinder.com/search/"], :root a[href^=" http://n47adshostnet.com/"], :root a[href^="http://ryushare.com/affiliate.python"], :root a[href^="http://threate.info/"], :root a[href*=".igraal.com/?parrain="] > img, :root a[data-obtrack^="http://paid.outbrain.com/network/redir?"], :root a[data-oburl^="http://paid.outbrain.com/network/redir?"], :root a[href^="http://get.slickvpn.com/"], :root a[data-oburl^="https://paid.outbrain.com/network/redir?"], :root a[data-redirect^="http://click.plista.com/pets"], :root a[href^="http://affiliate.godaddy.com/"], :root a[data-redirect^="this.href='http://paid.outbrain.com/network/redir?"], :root a[href^="http://adclick.g.doubleclick.net/"], :root a[href^="https://bs.serving-sys.com"], :root a[data-url^="http://paid.outbrain.com/network/redir?"], :root a[data-url^="http://paid.outbrain.com/network/redir?"] + .author, :root a[href^="http://hd-plugins.com/download/"], :root a[data-widget-outbrain-redirect^="http://paid.outbrain.com/network/redir?"], :root a[href$="/vghd.shtml"], :root a[href*=".adk2x.com/"], :root a[href^="http://mmo123.co/"], :root a[href*=".adsrv.eacdn.com/"] > img, :root .SamRotator > .SamLink, :root a[href*="://popcash.net/register/"], :root a[href^="http://k2s.cc/pr/"], :root a[href*=".qertewrt.com/"], :root a[href*=".trust.zone"], :root a[href^="http://xtgem.com/click?"], :root a[href^="http://dwn.pushtraffic.net/"], :root [id^="ad_block_"], :root a[href^="http://www.ducksnetwork.com/"], :root a[href*="/adrotate-out.php?"], :root a[href*="/cmd.php?ad="], :root a[href*="=Adtracker"], :root a[href*="ad2upapp.com/"], :root a[href^="http://mgid.com/"], :root a[href^="http://www.freefilesdownloader.com/"], :root a[href^=" http://ads.ad-center.com/"], :root a[href^="http://ads.integral-marketing.com/"], :root a[href^="http://data.ad.yieldmanager.net/"], :root a[href*="googleme.eu"], :root a[href^="//tracking.content-recommendation.net/"][href*="/sponsored/click.html?"], :root div[class^="ad_468_"], :root a[href^="http://www.sexgangsters.com/?"], :root a[href^=".bcvc.mobi/"], :root a[href*="letsadvertisetogether.com"], :root a[href*="onclkds."], :root a[href^="//adbit.co/?a=Advertise&"], :root div[onerror="fuck_adblock()"], :root a[href^="http://www.roboform.com/php/land.php"], :root a[href^="//ads.ad-center.com/"], :root a[href^="http://witalfieldt.com/"], :root a[href^="http://gamingaffiliation.com/"], :root a[href^="//api.ad-goi.com/"], :root a[href^="//t.MtagMonetizationA.com/"], :root a[href^="http://www.fpcTraffic2.com/blind/in.cgi?"], :root a[href^="//www.mgid.com/"], :root a[href^="http://www.babylon.com/welcome/index?affID"], :root a[href^="http://1phads.com/"], :root a[href^="http://internalredirect.site/"], :root a[href^="https://www.share-online.biz/affiliate/"], :root a[href^="http://360ads.go2cloud.org/"], :root a[href^="http://3wr110.net/"], :root a[href^="http://www.menaon.com/installs/"], :root a[href^="http://NowDownloadAll.com"], :root a[href^="http://a.adquantix.com/"], :root a[href^="http://downloadity.net/"], :root a[href^="http://ad-apac.doubleclick.net/"], :root a[href^="http://prousa.work/"], :root a[href^="http://fusionads.net"], :root a[href^="http://ad-emea.doubleclick.net/"], :root a[href^="http://ad.au.doubleclick.net/"], :root a[href^="http://ad.doubleclick.net/"], :root a[href^="http://adexprt.me/"], :root a[href^="http://feedads.g.doubleclick.net/"], :root a[href*="smartadserver.com/call/cliccommand/"] > img, :root a[href^="http://adf.ly/?id="], :root a[href^="http://api.ringtonematcher.com/"], :root a[href^="http://adfarm.mediaplex.com/"], :root a[href^="http://www.clkads.com/adServe/"], :root a[href^="http://adlev.neodatagroup.com/"], :root a[href^="http://www.gamingaffiliation.com/"], :root a[href^="http://wgpartner.com/"], :root a[href^="http://admingame.info/"], :root a[href^="http://adprovider.adlure.net/"], :root a[href*="ads_random"], :root a[href^="http://adrunnr.com/"], :root a[href^="http://www.sfippa.com/"], :root a[href^="http://ads.ad-center.com/"], :root a[href^="https://paid.outbrain.com/network/redir?"], :root div[id^="div_ad_stack_"], :root a[href*=".igraal.com/inscription?parrain="] > img, :root a[href^="http://ads.affbuzzads.com/"], :root a[href^="http://ads.expekt.com/affiliates/"], :root a[href^="https://trackjs.com/?utm_source"], :root a[href^="http://www.download-provider.org/"], :root a[href^="http://adserver.adtech.de/"], :root a[href^="http://adserver.adtechus.com/"], :root a[href^="http://cdn.adstract.com/"], :root a[href^="http://www.adxpansion.com"], :root a[href^=".php/ads/"], :root a[href^="http://www.socialsex.com/"], :root iframe[src^="http://cdn1.adexprt.com/"], :root a[href^="http://adserving.liveuniversenetwork.com/"], :root a[href^="http://adserving.unibet.com/"], :root a[href^="http://adsrv.keycaptcha.com"], :root a[href^="https://dediseedbox.com/clients/aff.php?"], :root a[href^="http://affiliate.flipkart.com/"], :root a[href^="http://www.installads.net/"], :root a[href^="http://clickserv.sitescout.com/"], :root a[href^="http://adtrack123.pl/"], :root div[id^="PostAd"], :root a[href^="https://keep2share.cc/pr/"], :root a[href^="http://adtrackone.eu/"], :root a[href^="http://adultfriendfinder.com/p/register.cgi?pid="], :root div[class^="Ad__adContainer"], :root a[href*="://begloffic.info/"], :root a[href^="http://aff.ironsocket.com/"], :root a[href*="/regiehab.php?"], :root [id*="_ads_id_"], :root a[href^="http://affiliate.coral.co.uk/processing/"], :root a[href^="http://earth-111.com/"], :root a[href^="http://affiliate.glbtracker.com/"], :root a[onclick*="/adserver/iframe?"], :root a[href^="http://affiliates.score-affiliates.com/"], :root a[href^="http://aflrm.com/"], :root a[href*="://www.tubeadvertising.eu/?rf="], :root a[href^="http://www.dealcent.com/register.php?affid="], :root a[href^="http://www.greenmangaming.com/?tap_a="], :root aside[id^="div-gpt-ad"], :root div[id^="ads300_100-widget"], :root a[href^="http://amzn.to/"] > img[src^="data"], :root a[href^="http://mojofun.info/"], :root a[href^="http://record.betsafe.com/"], :root a[href^="http://bruceleadx2.com/"], :root a[href^="http://anonymous-net.com/"], :root a[href^="http://api.content.ad/"], :root a[href^="http://at.atwola.com/"], :root a[href^="http://bc.vc/?r="], :root a[href^="http://games.ucoz.ru/"][target="_blank"], :root a[href^="https://www.dsct1.com/"], :root a[href^="http://www.bet365.com/"][href*="&affiliate="], :root a[href*="://aclick.adhoc4.com/"], :root a[href^="http://bestorican.com/"], :root a[href^="http://bluehost.com/track/"], :root a[href*="/tracking_campaign.php?"], :root [data-qwertize-zone], :root a[href^="http://bonusfapturbo.nmvsite.com/"], :root a[href^="http://bs.serving-sys.com/"], :root a[href^="http://www.downloadthesefiles.com/"], :root a[href^="http://c.actiondesk.com/"], :root a[href^="http://goldmoney.com/?gmrefcode="], :root a[href^="http://callville.xyz/"], :root div[id^="crt-"][style*="width:"], :root a[href^="http://campaign.bharatmatrimony.com/cbstrack/"], :root a[href^="http://campaign.bharatmatrimony.com/track/"], :root a[href^="http://casino-x.com/?partner"], :root a[href^="http://secure.signup-page.com/"], :root a[href^="http://cdn.adsrvmedia.net/"], :root a[href^="http://lp.ilivid.com/"], :root a[href^="http://cdn3.adbrau.com/"], :root a[href^="http://t.mdn2015x2.com/"], :root a[href^="http://www.accuserveadsystem.com/accuserve-go.php?"], :root a[href^="http://centertrust.xyz/"], :root a[style="display:block;width:300px;min-height:250px"][href^="http://li.cnet.com/click?"], :root a[href^="http://chaturbate.com/affiliates/"], :root a[href^="http://click.guamwnvgashbkashawhgkhahshmashcas.pw/"], :root div[id^="ads300_600-widget"], :root a[href^="http://www5.smartadserver.com/call/pubjumpi/"], :root a[href^="http://click.plista.com/pets"], :root a[href^="http://yotefiles.com/"], :root a[href^="/rdh?"], :root a[href^="http://clicks.guamwnvgashbkashawhgkhahshmashcas.pw/"], :root a[href^="http://clk.directrev.com/"], :root a[href^="http://clkmon.com/adServe/"], :root a[href^="http://connectlinking6.com/"], :root a[href^="http://contractallsticker.net/"], :root a[href^="http://cpaway.afftrack.com/"], :root a[href^="http://d2.zedo.com/"], :root a[href^="http://data.committeemenencyclopedicrepertory.info/"], :root a[href^="https://ad.atdmt.com/"], :root a[href^="https://adhealers.com/"], :root a[href*="https://relap.io/r?"], :root a[href^="http://www.fonts.com/BannerScript/"], :root a[href^="http://data.linoleictanzaniatitanic.com/"], :root a[href^="http://databass.info/"], :root div[id^="dmRosAdWrapper"], :root a[href^="http://ddownload39.club/"], :root iframe[src^="http://static.mozo.com.au/strips/"], :root a[href^="http://www.myfreepaysite.com/sfw.php?aid"], :root div[id^="dfp-ad-"], :root a[href^="http://dethao.com/"], :root a[href^="http://dftrck.com/"], :root [data-type="ligatus-script"], :root a[href^="http://down1oads.com/"], :root a[href^="http://www.torntvdl.com/"], :root input[onclick^="window.open('http://www.friendlyduck.com/"], :root a[href^="http://download-performance.com/"], :root a[href^="http://duckcash.eu/"], :root a[href^="http://eclkmpsa.com/"], :root a[href*="://c.xsnap.me/"], :root a[href^="http://elite-sex-finder.com/?"], :root [class^="lig_wrapper_ad_"], :root a[href^="http://www.downloadplayer1.com/"], :root a[href^="http://elitefuckbook.com/"], :root a[href*="friendlyduckaffiliates.com/"], :root a[href^="http://srvpub.com/"], :root div[class*="300x250_advertisement_"], :root a[href^="http://fileupnow.rocks/"], :root a[href^="http://finaljuyu.com/"], :root a[href^="http://findersocket.com/"], :root a[href^="http://go.mobisla.com/"], :root a[href*="utm_medium=mega_banniere"] > img, :root a[href^="http://freesoftwarelive.com/"], :root a[href^="http://t.mdn2015x1.com/"], :root a[href^="http://galleries.pinballpublishernetwork.com/"], :root iframe[id^="google_ads_iframe"], :root a[href^="http://galleries.securewebsiteaccess.com/"], :root a[href^="http://xch.smrtgs.com/"], :root a[href^="http://gca.sh/user/register?ref="], :root a[href^="http://www.affiliates1128.com/processing/"], :root a[href*="://www.grand-ads.com/"], :root a[href^="http://getlinksinaseconds.com/"], :root a[href^="http://go.ad2up.com/"], :root a[href^="http://go.seomojo.com/tracking202/"], :root a[href*="/adagency/"] > img, :root a[href^="http://green.trafficinvest.com/"], :root a[href*="://trustaffs.com/"], :root a[href^="http://greensmoke.com/"], :root a[href^="http://promos.bwin.com/"], :root div[id^="pub-dfp-"], :root a[href^="http://n.admagnet.net/"], :root a[href^="http://xmediaserve.com/"], :root .puFloatLine > #puFloatDiv, :root a[href^="http://guideways.info/"], :root a[href^="http://hdplugin.flashplayer-updates.com/"], :root a[target="_blank"][href^="http://api.taboola.com/"], :root a[href^="http://imads.integral-marketing.com/"], :root a[href^="http://install.securewebsiteaccess.com/"], :root a[href^="http://www.sex.com/?utm_"], :root div[id^="ADV-SLOT-"], :root a[href^="http://istri.it/?"], :root a[href^="http://join3.bannedsextapes.com/track/"], :root a[href^="http://latestdownloads.net/download.php?"], :root a[href^="http://linksnappy.com/?ref="], :root a[href^="http://liversely.net/"], :root a[href^="http://www.tirerack.com/affiliates/"], :root a[href^="http://lp.ezdownloadpro.info/"], :root div[class$="dealnews"] > .dealnews, :root div[class^="BlockAdvert-"], :root a[href^="https://oxhax.com/"], :root a[href^="http://marketgid.com"], :root a[href^="http://www.idownloadplay.com/"], :root a[href^="https://pubads.g.doubleclick.net/"], :root a[href^="http://mo8mwxi1.com/"], :root a[href^="http://www.flashx.tv/downloadthis"], :root a[href^="http://filesbee.com/"], :root a[href^="http://onclickads.net/"], :root a[href^="https://www.g2a.com/r/"] > img, :root a[href^="http://online.ladbrokes.com/promoRedirect?"], :root a[href^="http://pan.adraccoon.com?"], :root a[href^="http://papi.mynativeplatform.com:80/pub2/"], :root a[href^="http://www.graboid.com/affiliates/"], :root div[id^="MarketGid"], :root a[href^="http://propellerads.com/?rfd="], :root a[href^="http://partner.sbaffiliates.com/"], :root div[id^="betAds"], :root a[href^="http://adv-mypirate."], :root a[href^="http://prochina.link/"], :root a[href^="http://serve.williamhill.com/promoRedirect?"], :root a[href^="http://prochina.space/"], :root a[href^="http://www.1clickdownloader.com/"], :root a[href^="http://pubads.g.doubleclick.net/"], :root div[class^="Ad__bigBox"], :root a[href^="http://share.payoneer-affiliates.com/"], :root a[href^="http://pwrads.net/"], :root a[href^="http://www.brightwheel.info/"], :root a[href^="http://record.commissionking.com/"], :root a[href^="http://refer.webhostingbuzz.com/"], :root a[href^="http://tezfiles.com/pr/"], :root a[href^="http://rekoverr.com/"], :root a[href^="http://searchtabnew.com/"], :root a[href^="http://secure.hostgator.com/~affiliat/"], :root a[href^="http://see-work.info/"], :root a[href^="http://www.1clickmoviedownloader.info/"], :root a[href^="http://server.cpmstar.com/click.aspx?poolid="], :root a[href^="http://servicegetbook.net/"], :root a[href^="http://www.leguide.com/lettre/"], :root a[href^="http://www.sex.com/pics/?utm_"], :root a[href^="http://sharesuper.info/"], :root a[href^="http://www.badoink.com/go.php?"], :root a[href^="http://stateresolver.link/"], :root a[href^="http://t.mdn2015x3.com/"], :root a[href^="http://t.wowtrk.com/"], :root a[href^="http://tour.affbuzzads.com/"], :root a[href^="http://track.adform.net/"], :root a[href^="http://wxdownloadmanager.com/dl/"], :root a[href^="http://ads.reflexcash.com/"], :root a[href^="http://track.incognitovpn.com/"], :root a[href^="http://styleapplicationzillion.com/"], :root a[href^="http://www.pheedo.com/"], :root a[href*="://all2lnk.com/"], :root [class^="trivago_widget_"], :root a[href^="http://tracking.crazylead.com/"], :root a[href^="http://www.friendlyquacks.com/"], :root a[href^="http://tracking.deltamediallc.com/"], :root a[href^="http://tracking.toroadvertising.com/"], :root a[href^="https://bestapppro.com/"], :root a[href^="http://us.marketgid.com"], :root a[href^="http://www.firstload.com/affiliate/"], :root a[href^="http://webtrackerplus.com/"], :root a[href*="://ossicvr.com/"], :root a[href^="http://www.123-reg.co.uk/affiliate2.cgi"], :root a[href^="http://www.TwinPlan.com/AF_"], :root a[href^="http://www.bitlord.me/share/"], :root a[href^="http://www.adbrite.com/mb/commerce/purchase_form.php?"], :root a[href^="http://www.adshost2.com/"], :root a[href^="http://www.pubdirecte.com/script/"], :root a[href^="http://www.amazon.co.uk/exec/obidos/external-search?"], :root a[href^="http://www.cash-duck.com/"], :root div[id^="advads_"], :root a[href^="https://blockadz.com/?"], :root bottomadblock, :root a[href^="http://www.clickansave.net/"], :root [id^="ad_holder_text_"], :root a[href^="http://www.coinducks.com/"], :root a[href^="http://adprovider."], :root a[href^="http://www.dl-provider.com/search/"], :root a[href^="http://www.duckssolutions.com/"], :root a[href^="http://www.down1oads.com/"], :root a[href^="http://www.downloadweb.org/"], :root a[href^="http://www.duckcash.eu/"], :root a[href^="http://goodbeautyjob.com/"], :root [id^="sas_"][style*="width: 300px; height: 250px;"], :root a[href^="http://www.firstclass-download.com/"], :root a[href^="http://www.quick-torrent.com/download.html?aff"], :root a[href^="http://www.firstload.de/affiliate/"], :root a[href*="://www.hentai-heroes.com/"], :root a[href*=".inclk.com/"], :root a[href^="http://www.fleshlight.com/"], :root div[id^="block-views-topheader-ad-block-"], :root a[href^="http://www.gamebookers.com/cgi-bin/intro.cgi?"], :root a[href^="https://understandsolar.com/signup/?lead_source="][href*="&tracking_code="], :root a[href^="http://www.incredimail.com/?id="], :root a[href^="http://www.on2url.com/app/adtrack.asp"], :root a[href^="http://www.ireel.com/signup?ref"], :root a[href^="http://www.zergnet.com/i/"], :root a[href^="http://www.plus500.com/?id="], :root a[href^="http://www.linkbucks.com/referral/"], :root a[href^="http://www.liutilities.com/"], :root a[href*="/afu.php?"], :root a[href^="http://www.liversely.net/"], :root iframe[id^="google_ads_frame"], :root a[href^="http://www.mobileandinternetadvertising.com/"], :root a[href*=".ichlnk.com/"], :root [class][data-sitename][data-header-version] > div[id^="detection-block"], :root a[href^="http://www.my-dirty-hobby.com/?sub="], :root a[href^="http://www.myfreecams.com/?co_id="][href*="&track="], :root a[href*="/buy?a_aid="], :root a[href^="http://www.myfreepaysite.com/sfw_int.php?aid"], :root a[onmousedown^="this.href='http://staffpicks.outbrain.com/network/redir?"][target="_blank"], :root a[href*="/?a_aid="], :root a[href^="https://go.ad2up.com/"], :root a[href^="http://www.mysuperpharm.com/"], :root a[href^="http://www.sex.com/videos/?utm_"], :root a[href^="https://ad.doubleclick.net/"], :root a[href^="https://ouicesoir.com/"], :root a[href^="http://www.myvpn.pro/"], :root a[href^="http://www.pinkvisualpad.com/?revid="], :root a[href^="http://www.revenuehits.com/"], :root a[href^="https://chaturbate.com/affiliates/"], :root a[href^="http://www.richducks.com/"], :root a[href*="/redirect?partenaire="], :root a[href^="http://www.seekbang.com/cs/"], :root a[href^="http://go.wwwdg.net/"], :root a[href*=".igraal.com/#parrain="] > img, :root div[id^="ad-div-"], :root a[href^="http://www.sexgangsters.com/?pid="], :root a[href^="http://www.streamate.com/exports/"], :root a[href^="http://www.text-link-ads.com/"], :root a[href^="http://www.torntv-downloader.com/"], :root a[href^="http://www.twinplan.com/AF_"], :root a[href^="http://www.urmediazone.com/signup"], :root a[href^="http://www.wantstraffic.com/"], :root a[href^="http://www.webtrackerplus.com/"], :root #infopopup > a > img, :root a[href^="http://www.xmediaserve.com/"], :root a[href^="http://www.yourfuckbook.com/?"], :root a[href^="http://www1.clickdownloader.com/"], :root a[href*=".brucelead.com/"], :root a[href^="https://www.adskeeper.co.uk/"], :root a[href^="http://fave.co/"], :root a[href^="http://yads.zedo.com/"], :root a[href^="http://z1.zedo.com/"], :root a[href^="http://zevera.com/afi.html"], :root div[id^="ad-server-"], :root a[href^="https://affiliates.bet-at-home.com/processing/"], :root a[href^="https://atomidownload.com/"], :root [onclick*="http://www.affbuzzads.com/affiliate/"], :root a[href^="https://click.plista.com/pets"], :root a[href^="http://clicks.totemcash.com/"], :root a[href^="https://dcs.adgear.com/clicks/"], :root a[href*="/goto.php?ads_id="], :root a[href^="https://dltags.com/"], :root div[id^="M"][id*="Composite"], :root div[id^="dfp-slot-"], :root a[href*="/ads?key="], :root a[href^="https://farm.plista.com/pets"], :root [slot-id^="div-gpt-ad-"], :root a[href^="https://secure.eveonline.com/ft/?aid="], :root a[href^="http://lifeselector.com/game/listGames?"], :root a[href^="https://torguard.net/aff.php"], :root a[href^="https://tracking.truthfinder.com/?a="], :root a[href^="https://trklvs.com/"], :root a[href^="https://trust.zone/go/r.php?RID="], :root script[src^="http://www.pubdirecte.com/script/"], :root [id^="ads_ooredoo"], :root a[href^="https://windscribe.com/promo/"], :root a[href^="https://www.camyou.com/?cam="][href*="&track="], :root a[href^="https://www.googleadservices.com/pagead/aclk?"], :root a[href^="https://www.oboom.com/ad/"], :root a[href^="https://www.popads.net/users/"], :root a[href^="https://www.secureupload.eu/suprerefid="], :root a[onmousedown^="this.href='/wp-content/embed-ad-content/"], :root a[href^="http://www.espace-plus.net/"], :root a[href^="http://always-parser.xyz/"], :root a[onmousedown^="this.href='http://paid.outbrain.com/network/redir?"][target="_blank"], :root a[href^="http://afflight.postaffiliatepro.com/"], :root a[onmousedown^="this.href='http://paid.outbrain.com/network/redir?"][target="_blank"] + .ob_source, :root [id^="ads_djezzy"], :root a[onmousedown^="this.href='https://paid.outbrain.com/network/redir?"][target="_blank"], :root a[onmousedown^="this.href='https://paid.outbrain.com/network/redir?"][target="_blank"] + .ob_source, :root a[target="_blank"][onmousedown="this.href^='http://paid.outbrain.com/network/redir?"], :root div > [class][onclick*=".updateAnalyticsEvents"], :root div[class^="Ad__container"], :root div[class^="gemini-ad"], :root [id*="-partners-adserver-"], :root div[class^="local-feed-banner-ads"], :root a[href^="http://downloadplayer.xyz/"], :root div[class^="proadszone-"], :root div[id^="YFBMSN"], :root div[id^="acm-ad-tag-"], :root a[href^="http://www.vipromoffers.com/"], :root div[id^="adrotate_widgets-"], :root a[href*=".get-media.co/"], :root div[id^="ads250_250-widget"], :root a[href*="://adlipay.com/ref/"], :root div[id^="ads300_250-widget"], :root div[id^="advads-"], :root div[id^="cns_ads_"], :root div[id^="crt-"][style], :root div[id^="google_ads_iframe_"], :root div[id^="google_dfp_"], :root div[id^="lazyad-"], :root div[id^="proadszone-"], :root a[href^="http://www.easyflirt-partners.biz"], :root div[id^="q1-adset-"], :root div[itemtype="http://schema.org/WPAdBlock"], :root a[href^="http://redir.bebi.com/"], :root topadblock, :root div[itemtype="http://www.schema.org/WPAdBlock"], :root iframe[src^="http://ad.yieldmanager.com/"], :root a[href^="http://clicks.toteme.com/"], :root iframe[src^="http://cdn2.adexprt.com/"], :root img[alt^="Fuckbook"], :root input[onclick^="window.open('http://www.FriendlyDuck.com/"], :root p[id^="div-gpt-ad-"], :root script[src^="http://free-shoutbox.net/app/webroot/shoutbox/sb.php?shoutbox="] + #freeshoutbox_content, :root a[href^="http://www.questiondivine.com/?ctid="], :root a[href^="http://js.bulkhentai.com/"], :root td[valign="top"] > .mainmenu[style="padding:10px 0 0 0 !important;"], :root .dfp > a > img, :root a[href^="http://click.union.ucweb.com/"], :root .info_pop > a > img, :root .puFloatLine > .puFloatDiv, :root [class$="_banner-sponsor"], :root [class^="ads300_600-widget-"], :root [class^="ads_inline_"], :root [class^="lig_campaign_"], :root [class^="region-pub-bottom-"], :root [class^="region-pub-position-"], :root [class^="thumb-pub-860"], :root a[href^="http://www.mediaprogramasdlmdelivery.com/"], :root [data-type="ad"][data-format], :root [data-type="ad"][data-publisher], :root a[href^="https://partner.zenmate.com/"], :root [id*="ScriptRootC"] > [id*="PreloadC"], :root a[href^="http://filesbride.com/"], :root [id*="_custom_ads-"], :root [id^="ads_adnemo_"], :root [id^="ads_mobilis"], :root [id^="block-xiti_oas-"], :root [id^="codeneric_ad_widget-"], :root [id^="div-gpt-"] + [id^="ctr-"], :root [id^="lig_wrapper_ad_"], :root [id^="ligatus-"], :root [id^="ligatus_"], :root [id^="pub-carasexe-"], :root div[id^="div-adt-"], :root [id^="pub_728x90_"], :root [id^="pub_dart_"], :root [id^="sas_"][style*="width: 728px; height: 90px;"], :root [onclick*="/rel/index.cfm?RST="], :root [onclick*="/rel/index.cfm?TAD="], :root a[href^="http://ads.affiliation-france.com/"], :root [onclick*="duckcash.eu/AF_"], :root [onclick*="friendlyduck.com/AF_"], :root a > #bg-ad, :root a[href$="?id=300x250"][target="_blank"] > img, :root a[href*="%2Fapi%2Fmpup%2F"], :root div > [class][data-pos] > .SamLink, :root a[href*=".ad2up.com/"], :root a[href^="http://www.ba-click.com/?ref="], :root a[href*=".onclasrv.com/"], :root a[href*="/adServe/banners?"], :root a[href*=".ourtoolbar.com"], :root a[href^="http://www.marketdot.net/"], :root a[href*=".php?sp_promote="], :root div[id^="block-views-ads-sidebar-"], :root a[href*=".voluumtrk.com/"], :root a[href*=".xxcdn.pw/"], :root a[href*="/a/display.php?"], :root a[href*="/adclick."], :root a[href*="/adclick?"], :root a[href*="/ads.php?ref="], :root a[href*="/ads/ad_link."], :root a[href*="/ads/click?"], :root a[href*="/adserver/iframe?"], :root a[href*="/adsrvmedia."], :root a[href*="/adstract."], :root a[href*="/adv-mybankai."], :root a[href*="/afiliados.html?id="], :root a[href*="/click/?idadprint="], :root a[href*="/clickhabillage/"][target="_blank"], :root a[href*="/earn.php?zone="], :root a[href^="https://r.ligatus.com/"], :root a[href^="https://admin.thrixxx.com/affiliates/"], :root a[href*="/install-app?affid="], :root a[href*="/inter?implementation_id="], :root a[href*="/p_tools/promo.php?"], :root a[href*="/redirect.php?title="], :root a[href*="/redirect?tid="], :root a[href*="qadserver.com"], :root a[href*="/rel/index.cfm?TAD="], :root a[href*="/rotation_pdv.php?"], :root a[href*="/telechargement-rapide.php?"], :root a[href*="://3wr110.xyz/"], :root a[href*="://aclick.adhoc1.net/"], :root a[href*="://aclick.adhoc2.net/"], :root a[href*="://adpv.com/?idpartner="], :root a[href*="://adskeeper.co.uk/"], :root a[href*="://adsoptimal.com/?"], :root a[href^="http://promo.vador.com/"], :root a[href*="://c.anytrx.com/"], :root a[href*="://c.tnkexchange.com/"], :root a[href^="http://www.rabbitfinder.com/refer."], :root a[href*="://duck-quack.com/"], :root a[href*="://ouo.press/ref/"], :root a[href*="://goodclickads.com/"], :root a[href*="://mobidea.com/?r="], :root a[href*="://popads.net/users/refer/"], :root a[href*="://serietrk.me/"], :root a[href*="://smart.tubeadvertising.eu/"], :root a[href*="://syndication."] > img, :root a[href*="://toroadvertisingmedia.com/"], :root a[href*="://www.anrdoezrs.net/"], :root a[href*="://www.ducksnetwork.com/"], :root a[href*="://www.duckssolutions.com/"], :root a[href*="://www.hentai-heroes.es/"], :root a[href*="://www.hentaiheroes.com/"], :root a[href*="://www.moon-ads.com/"], :root a[href*="://yllix.com/"], :root a[href*="?ad_id="], :root a[href*="_728x90_bleach_adb"], :root a[href*="_728x90_bleachsx_adb"], :root a[href*="ducklingquacks.com/"], :root a[href*="europeantorrents.download/"], :root a[href*="fastclick.net/ad/"], :root a[href*="fducks.com/"], :root a[href*="friendlyquacks.com/"], :root a[href*="marketgid.com/"], :root a[href*="medncom.com/regie/"], :root a[href*="popads.net/users/refer/"], :root a[href*="smartadserver.com/h/cc?imgid="] > img, :root a[href*="weborama.fr/fcgi-bin/"], :root a[href^="http://www.yourfilezone.com/"], :root a[href*="xiti.com/go.ad?"], :root a[href^="https://ad.apps.fm/"], :root a[href="http://smarturl.it/warshipsint"], :root a[href^="://manage.hostvn.net/aff.php?"] > img, :root a[href^="ads.php?id="], :root a[href^="http://3dxchat.com/?"], :root a[href^="http://178.175.132.130/"], :root a[href^="http://adminlady.info/"], :root a[href^="http://adv-mylegend."], :root a[href^="http://adv-myninja."], :root a[href^="http://affiliates.lifeselector.com/"], :root a[href^="http://allovid.net/"], :root a[href^="http://altadefinizone.click/"], :root a[href^="http://altarisoluzione.online/"], :root a[href^="http://api.adlure.net/"], :root a[href^="http://bvn-inv.com/"], :root a[href^="http://centredecontrole.biz/ads/"], :root a[href^="http://filesify.com/"], :root a[href^="http://freedowns.info/"], :root a[href^="http://frtyd.com/"], :root a[href^="http://givemeclip.com/"], :root a[href^="http://t2lgo.com/"], :root a[href^="http://go2me.tk/"], :root a[href^="http://hits.epochstats.com/"], :root a[href^="http://jouthad.com/"], :root a[href^="http://www.downloadplayer2.com/"], :root a[href^="http://lp.ilividnewtab.com/"], :root a[href^="http://m.mobilerevenu.com/idw/"], :root a[href^="http://mytogolinks.com/?"], :root a[href^="http://partner.global-espace.com/"], :root a[href^="http://plateforme.flinteractive.fr/affiliation/lead/clic?"], :root a[href^="http://porno.pornocrados.com/"], :root a[href^="http://pussl7.com/"], :root a[href^="http://reallygoodlink.free3dadultgames.com/"], :root a[href^="http://refer.ccbill.com/cgi-bin/clicks.cgi?"], :root a[href^="http://secureboom.net/"], :root a[href^="http://seminings.info/"], :root a[href^="http://sexgamedevil.com/?"], :root a[href^="http://siement.info/"], :root a[href^="http://streamsign.me/"], :root a[href^="http://tool.acces-vod.com/"], :root a[href^="http://wct.link/"], :root a[href^="http://wlx-secure.com/"], :root a[href^="http://www.affiliation-france.com/"], :root a[href^="http://www.allopass.com/"] > img, :root a[href^="http://www.apk-download-free.com/"], :root a[href^="http://www.gaddin.com/index.php?sponsor"] > img, :root a[href^="http://www.movie4all.co/"], :root a[href^="http://www.redlightcenter.com/"], :root a[href^="http://www.tradeadexchange.com/"], :root a[href^="http://www.xl415.com/"], :root a[href^="https://secure.securitetotale.com/"], :root a[href^="https://store.mspy.com/affiliate.php"] > img, :root a[href^="https://traceless.me/lp/"], :root a[href^="https://www.le-vpn.com/clients/aff.php?"], :root a[onclick*="FriendlyDuck.com"], :root a[onclick^="CustomWLAdServer."], :root style + div[id*="ScriptRootC"], :root div[class*="view-ads-header-"], :root a[href="https://goo.gl/MUeQOW"], :root div[class*="view-id-ads_header_"], :root div[class*="view-id-ads_sidebar_"], :root div[class^="ad_200_"], :root div[id$="textAdsBox"], :root div[id*="_div_ads_header_"], :root div[id*="_main_ads_header_"], :root div[id*="_section_ads_header_"], :root div[id^="adzerk-"], :root div[id^="block-dfp-728-"], :root div[id^="block-views-ads-header-"], :root div[onclick*="/regiedeep.php?"], :root gwd-doubleclick, :root iframe[name*="/adunblock_"], :root section[onclick*="/publicite-300-250/"], :root table > tbody > tr > td > a[href="http://www.pubdirecte.com"], :root .samBannerUnit > .SamLink { display: none !important; }</style><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.1c973af76c6535955110c0c9d8551865.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.8edffe1405dcc2d5eb5ee9d96a2866d1.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.8d07a4869c3ec17ee1881ae6bd353027.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><script type="text/javascript" charset="utf-8" async="" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/button.56dc123afbb0751e96ef7a8b31bd56e2.js.téléchargé"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_loader{background-color:#f6f7f9;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;bottom:0;left:0;right:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #29487d;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f9;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_invisible_flow{display:inherit;height:0;overflow-x:hidden;width:0}.fb_mobile_overlay_active{height:100%;overflow:hidden;position:fixed;width:100%}.fb_shrink_active{opacity:1;transform:scale(1, 1);transition-duration:200ms;transition-timing-function:ease-out}.fb_shrink_active:active{opacity:.5;transform:scale(.75, .75)}</style><style type="text/css" id="igtranslator-color"></style></head>

  <body style=""><div id="StayFocusd-infobar" style="display: none; top: 2178.4px;">
    <img src="chrome-extension://laankejkbhbdhmipfmgcngdelahlfoji/common/img/eye_19x19_red.png">
    <span id="StayFocusd-infobar-msg"></span>
    <span id="StayFocusd-infobar-links">
        <a id="StayFocusd-infobar-never-show">masquer définitivement</a>&nbsp;&nbsp;|&nbsp;&nbsp;
        <a id="StayFocusd-infobar-hide">masquer une&nbsp;fois</a>
    </span>
</div><div id="MathJax_Message" style="display: none;"></div>
  <!-- Facebook SDK -->
  <div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/lY4eZXm_YWu.html" style="border: none;"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <div id="navigation" class="clearfix">
    <a href="https://brennan.io/">Home</a>
    <a href="https://brennan.io/blog">Blog</a>
    <a href="https://brennan.io/talks/">Talks</a>
    <a href="https://brennan.io/projects">Projects</a>
    <a href="https://brennan.io/resume">Resume</a>
  </div>

  <div class="site-content">
    <h1>Tutorial - Write a Shell in C</h1>
<em>Stephen Brennan • 16 January 2015</em>

<p>It’s easy to view yourself as “not a <em>real</em> programmer.”  There are programs out
there that everyone uses, and it’s easy to put their developers on a pedestal.
Although developing large software projects isn’t easy, many times the basic
idea of that software is quite simple.  Implementing it yourself is a fun way to
show that you have what it takes to be a real programmer.  So, this is a
walkthrough on how I wrote my own simplistic Unix shell in C, in the hopes that
it makes other people feel that way too.</p>

<p>The code for the shell described here, dubbed <code class="highlighter-rouge">lsh</code>, is available on
<a href="https://github.com/brenns10/lsh">GitHub</a>.</p>

<p><strong>University students beware!</strong> Many classes have assignments that ask you to
write a shell, and some faculty are aware of this tutorial and code.  If you’re
a student in such a class, you shouldn’t copy (or copy then modify) this code
without permission.  And even then, I would <a href="https://brennan.io/2016/03/29/dishonesty/">advise</a> against heavily relying on this tutorial.</p>

<h2 id="basic-lifetime-of-a-shell">Basic lifetime of a shell</h2>

<p>Let’s look at a shell from the top down.  A shell does three main things in its
lifetime.</p>

<ul>
  <li><strong>Initialize</strong>: In this step, a typical shell would read and execute its
configuration files.  These change aspects of the shell’s behavior.</li>
  <li><strong>Interpret</strong>: Next, the shell reads commands from stdin (which could be
interactive, or a file) and executes them.</li>
  <li><strong>Terminate</strong>: After its commands are executed, the shell executes any
shutdown commands, frees up any memory, and terminates.</li>
</ul>

<p>These steps are so general that they could apply to many programs, but we’re
going to use them for the basis for our shell.  Our shell will be so simple that
there won’t be any configuration files, and there won’t be any shutdown command.
So, we’ll just call the looping function and then terminate.  But in terms of
architecture, it’s important to keep in mind that the lifetime of the program is
more than just looping.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Load config files, if any.
</span>
  <span class="c1">// Run command loop.
</span>  <span class="n">lsh_loop</span><span class="p">();</span>

  <span class="c1">// Perform any shutdown/cleanup.
</span>
  <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here you can see that I just came up with a function, <code class="highlighter-rouge">lsh_loop()</code>, that will
loop, interpreting commands.  We’ll see the implementation of that next.</p>

<h2 id="basic-loop-of-a-shell">Basic loop of a shell</h2>

<p>So we’ve taken care of how the program should start up.  Now, for the basic
program logic: what does the shell do during its loop?  Well, a simple way to
handle commands is with three steps:</p>

<ul>
  <li><strong>Read</strong>: Read the command from standard input.</li>
  <li><strong>Parse</strong>: Separate the command string into a program and arguments.</li>
  <li><strong>Execute</strong>: Run the parsed command.</li>
</ul>

<p>Here, I’ll translate those ideas into code for <code class="highlighter-rouge">lsh_loop()</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">lsh_loop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">line</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

  <span class="k">do</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"&gt; "</span><span class="p">);</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">lsh_read_line</span><span class="p">();</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">lsh_split_line</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">lsh_execute</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Let’s walk through the code.  The first few lines are just declarations.  The
do-while loop is more convenient for checking the status variable, because it
executes once before checking its value.  Within the loop, we print a prompt,
call a function to read a line, call a function to split the line into args, and
execute the args.  Finally, we free the line and arguments that we created
earlier.  Note that we’re using a status variable returned by <code class="highlighter-rouge">lsh_execute()</code> to
determine when to exit.</p>

<h2 id="reading-a-line">Reading a line</h2>

<p>Reading a line from stdin sounds so simple, but in C it can be a hassle.  The
sad thing is that you don’t know ahead of time how much text a user will enter
into their shell.  You can’t simply allocate a block and hope they don’t exceed
it.  Instead, you need to start with a block, and if they do exceed it,
reallocate with more space.  This is a common strategy in C, and we’ll use it to
implement <code class="highlighter-rouge">lsh_read_line()</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define LSH_RL_BUFSIZE 1024
</span><span class="kt">char</span> <span class="o">*</span><span class="nf">lsh_read_line</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">bufsize</span> <span class="o">=</span> <span class="n">LSH_RL_BUFSIZE</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="n">bufsize</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buffer</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"lsh: allocation error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Read a character
</span>    <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>

    <span class="c1">// If we hit EOF, replace it with a null character and return.
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">EOF</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">buffer</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">buffer</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">position</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// If we have exceeded the buffer, reallocate.
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="o">&gt;=</span> <span class="n">bufsize</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">bufsize</span> <span class="o">+=</span> <span class="n">LSH_RL_BUFSIZE</span><span class="p">;</span>
      <span class="n">buffer</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"lsh: allocation error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The first part is a lot of declarations.  If you hadn’t noticed, I prefer to
keep the old C style of declaring variables before the rest of the code.  The
meat of the function is within the (apparently infinite) <code class="highlighter-rouge">while (1)</code> loop.  In
the loop, we read a character (and store it as an <code class="highlighter-rouge">int</code>, not a <code class="highlighter-rouge">char</code>, that’s
important!  EOF is an integer, not a character, and if you want to check for it,
you need to use an <code class="highlighter-rouge">int</code>.  This is a common beginner C mistake.).  If it’s the
newline, or EOF, we null terminate our current string and return it.  Otherwise,
we add the character to our existing string.</p>

<p>Next, we see whether the next character will go outside of our current buffer
size.  If so, we reallocate our buffer (checking for allocation errors) before
continuing.  And that’s really it.</p>

<p>Those who are intimately familiar with newer versions of the C library may note
that there is a <code class="highlighter-rouge">getline()</code> function in <code class="highlighter-rouge">stdio.h</code> that does most of the work we
just implemented.  To be completely honest, I didn’t know it existed until after
I wrote this code.  This function was a GNU extension to the C library until
2008, when it was added to the specification, so most modern Unixes should have
it now.  I’m leaving my existing code the way it is, and I encourage people to
learn it this way first before using <code class="highlighter-rouge">getline</code>.  You’d be robbing yourself of a
learning opportunity if you didn’t!  Anyhow, with <code class="highlighter-rouge">getline</code>, the function
becomes trivial:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="nf">lsh_read_line</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">line</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">ssize_t</span> <span class="n">bufsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// have getline allocate a buffer for us
</span>  <span class="n">getline</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bufsize</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">line</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="parsing-the-line">Parsing the line</h2>

<p>OK, so if we look back at the loop, we see that we now have implemented
<code class="highlighter-rouge">lsh_read_line()</code>, and we have the line of input.  Now, we need to parse that
line into a list of arguments.  I’m going to make a glaring simplification here,
and say that we won’t allow quoting or backslash escaping in our command line
arguments.  Instead, we will simply use whitespace to separate arguments from
each other.  So the command <code class="highlighter-rouge">echo "this message"</code> would not call echo with a
single argument <code class="highlighter-rouge">this message</code>, but rather it would call echo with two
arguments: <code class="highlighter-rouge">"this</code> and <code class="highlighter-rouge">message"</code>.</p>

<p>With those simplifications, all we need to do is “tokenize” the string using
whitespace as delimiters.  That means we can break out the classic library
function <code class="highlighter-rouge">strtok</code> to do some of the dirty work for us.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define LSH_TOK_BUFSIZE 64
#define LSH_TOK_DELIM " \t\r\n\a"
</span><span class="kt">char</span> <span class="o">**</span><span class="nf">lsh_split_line</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">line</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">bufsize</span> <span class="o">=</span> <span class="n">LSH_TOK_BUFSIZE</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">**</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">bufsize</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">token</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tokens</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"lsh: allocation error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">token</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">LSH_TOK_DELIM</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">token</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">tokens</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span><span class="p">;</span>
    <span class="n">position</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="o">&gt;=</span> <span class="n">bufsize</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">bufsize</span> <span class="o">+=</span> <span class="n">LSH_TOK_BUFSIZE</span><span class="p">;</span>
      <span class="n">tokens</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">bufsize</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tokens</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"lsh: allocation error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">token</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">LSH_TOK_DELIM</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">tokens</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">tokens</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If this code looks suspiciously similar to <code class="highlighter-rouge">lsh_read_line()</code>, it’s because it
is!  We are using the same strategy of having a buffer and dynamically expanding
it.  But this time, we’re doing it with a null-terminated array of pointers
instead of a null-terminated array of characters.</p>

<p>At the start of the function, we begin tokenizing by calling <code class="highlighter-rouge">strtok</code>.  It
returns a pointer to the first token.  What <code class="highlighter-rouge">strtok()</code> actually does is return
pointers to within the string you give it, and place <code class="highlighter-rouge">\0</code> bytes at the end of
each token.  We store each pointer in an array (buffer) of character
pointers.</p>

<p>Finally, we reallocate the array of pointers if necessary.  The process repeats
until no token is returned by <code class="highlighter-rouge">strtok</code>, at which point we null-terminate the
list of tokens.</p>

<p>So, once all is said and done, we have an array of tokens, ready to execute.
Which begs the question, how do we do that?</p>

<h1 id="how-shells-start-processes">How shells start processes</h1>

<p>Now, we’re really at the heart of what a shell does.  Starting processes is the
main function of shells.  So writing a shell means that you need to know exactly
what’s going on with processes and how they start.  That’s why I’m going to take
us on a short diversion to discuss processes in Unix.</p>

<p>There are only two ways of starting processes on Unix.  The first one (which
almost doesn’t count) is by being Init.  You see, when a Unix computer boots,
its kernel is loaded.  Once it is loaded and initialized, the kernel starts only
one process, which is called Init.  This process runs for the entire length of
time that the computer is on, and it manages loading up the rest of the
processes that you need for your computer to be useful.</p>

<p>Since most programs aren’t Init, that leaves only one practical way for
processes to get started: the <code class="highlighter-rouge">fork()</code> system call.  When this function is
called, the operating system makes a duplicate of the process and starts them
both running.  The original process is called the “parent”, and the new one is
called the “child”.  <code class="highlighter-rouge">fork()</code> returns 0 to the child process, and it returns to
the parent the process ID number (PID) of its child.  In essence, this means
that the only way for new processes is to start is by an existing one
duplicating itself.</p>

<p>This might sound like a problem.  Typically, when you want to run a new process,
you don’t just want another copy of the same program – you want to run a
different program.  That’s what the <code class="highlighter-rouge">exec()</code> system call is all about.  It
replaces the current running program with an entirely new one.  This means that
when you call <code class="highlighter-rouge">exec</code>, the operating system stops your process, loads up the new
program, and starts that one in its place.  A process never returns from an
<code class="highlighter-rouge">exec()</code> call (unless there’s an error).</p>

<p>With these two system calls, we have the building blocks for how most programs
are run on Unix.  First, an existing process forks itself into two separate
ones.  Then, the child uses <code class="highlighter-rouge">exec()</code> to replace itself with a new program.  The
parent process can continue doing other things, and it can even keep tabs on its
children, using the system call <code class="highlighter-rouge">wait()</code>.</p>

<p>Phew!  That’s a lot of information, but with all that background, the following
code for launching a program will actually make sense:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">lsh_launch</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="n">wpid</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

  <span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Child process
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">execvp</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">perror</span><span class="p">(</span><span class="s">"lsh"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Error forking
</span>    <span class="n">perror</span><span class="p">(</span><span class="s">"lsh"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Parent process
</span>    <span class="k">do</span> <span class="p">{</span>
      <span class="n">wpid</span> <span class="o">=</span> <span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="n">WUNTRACED</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">WIFEXITED</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">WIFSIGNALED</span><span class="p">(</span><span class="n">status</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Alright.  This function takes the list of arguments that we created earlier.
Then, it forks the process, and saves the return value.  Once <code class="highlighter-rouge">fork()</code> returns,
we actually have <em>two</em> processes running concurrently.  The child process will
take the first if condition (where <code class="highlighter-rouge">pid == 0</code>).</p>

<p>In the child process, we want to run the command given by the user.  So, we use
one of the many variants of the <code class="highlighter-rouge">exec</code> system call, <code class="highlighter-rouge">execvp</code>.  The different
variants of <code class="highlighter-rouge">exec</code> do slightly different things.  Some take a variable number of
string arguments.  Others take a list of strings.  Still others let you specify
the environment that the process runs with.  This particular variant expects a
program name and an array (also called a vector, hence the ‘v’) of string
arguments (the first one has to be the program name).  The ‘p’ means that
instead of providing the full file path of the program to run, we’re going to
give its name, and let the operating system search for the program in the path.</p>

<p>If the exec command returns -1 (or actually, if it returns at all), we know
there was an error.  So, we use <code class="highlighter-rouge">perror</code> to print the system’s error message,
along with our program name, so users know where the error came from.  Then, we
exit so that the shell can keep running.</p>

<p>The second condition (<code class="highlighter-rouge">pid &lt; 0</code>) checks whether <code class="highlighter-rouge">fork()</code> had an error.  If so,
we print it and keep going – there’s no handling that error beyond telling the
user and letting them decide if they need to quit.</p>

<p>The third condition means that <code class="highlighter-rouge">fork()</code> executed successfully. The parent
process will land here.  We know that the child is going to execute the process,
so the parent needs to wait for the command to finish running.  We use
<code class="highlighter-rouge">waitpid()</code> to wait for the process’s state to change.  Unfortunately,
<code class="highlighter-rouge">waitpid()</code> has a lot of options (like <code class="highlighter-rouge">exec()</code>).  Processes can change state in
lots of ways, and not all of them mean that the process has ended.  A process
can either exit (normally, or with an error code), or it can be killed by a
signal.  So, we use the macros provided with <code class="highlighter-rouge">waitpid()</code> to wait until either
the processes are exited or killed.  Then, the function finally returns a 1, as
a signal to the calling function that we should prompt for input again.</p>

<h2 id="shell-builtins">Shell Builtins</h2>

<p>You may have noticed that the <code class="highlighter-rouge">lsh_loop()</code> function calls <code class="highlighter-rouge">lsh_execute()</code>, but
above, we titled our function <code class="highlighter-rouge">lsh_launch()</code>.  This was intentional!  You see,
most commands a shell executes are programs, but not all of them.  Some of them
are built right into the shell.</p>

<p>The reason is actually pretty simple.  If you want to change directory, you need
to use the function <code class="highlighter-rouge">chdir()</code>.  The thing is, the current directory is a
property of a process.  So, if you wrote a program called <code class="highlighter-rouge">cd</code> that changed
directory, it would just change its own current directory, and then terminate.
Its parent process’s current directory would be unchanged.  Instead, the shell
process itself needs to execute <code class="highlighter-rouge">chdir()</code>, so that its own current directory is
updated.  Then, when it launches child processes, they will inherit that
directory too.</p>

<p>Similarly, if there was a program named <code class="highlighter-rouge">exit</code>, it wouldn’t be able to exit the
shell that called it.  That command also needs to be built into the shell.
Also, most shells are configured by running configuration scripts, like
<code class="highlighter-rouge">~/.bashrc</code>.  Those scripts use commands that change the operation of the shell.
These commands could only change the shell’s operation if they were implemented
within the shell itself.</p>

<p>So, it makes sense that we need to add some commands to the shell itself.  The
ones I added to my shell are <code class="highlighter-rouge">cd</code>, <code class="highlighter-rouge">exit</code>, and <code class="highlighter-rouge">help</code>.  Here are their function
implementations below:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
  Function Declarations for builtin shell commands:
 */</span>
<span class="kt">int</span> <span class="n">lsh_cd</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">lsh_help</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">lsh_exit</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">);</span>

<span class="cm">/*
  List of builtin commands, followed by their corresponding functions.
 */</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">builtin_str</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"cd"</span><span class="p">,</span>
  <span class="s">"help"</span><span class="p">,</span>
  <span class="s">"exit"</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">builtin_func</span><span class="p">[])</span> <span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
  <span class="o">&amp;</span><span class="n">lsh_cd</span><span class="p">,</span>
  <span class="o">&amp;</span><span class="n">lsh_help</span><span class="p">,</span>
  <span class="o">&amp;</span><span class="n">lsh_exit</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">lsh_num_builtins</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">builtin_str</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*
  Builtin function implementations.
*/</span>
<span class="kt">int</span> <span class="nf">lsh_cd</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"lsh: expected argument to </span><span class="se">\"</span><span class="s">cd</span><span class="se">\"\n</span><span class="s">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">chdir</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">perror</span><span class="p">(</span><span class="s">"lsh"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">lsh_help</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Stephen Brennan's LSH</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Type program names and arguments, and hit enter.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"The following are built in:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lsh_num_builtins</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"  %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">builtin_str</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"Use the man command for information on other programs.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">lsh_exit</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There are three parts to this code.  The first part contains <em>forward
declarations</em> of my functions.  A forward declaration is when you declare (but
don’t define) something, so that you can use its name before you define it.  The
reason I do this is because <code class="highlighter-rouge">lsh_help()</code> uses the array of builtins, and the
arrays contain <code class="highlighter-rouge">lsh_help()</code>.  The cleanest way to break this dependency cycle is
by forward declaration.</p>

<p>The next part is an array of builtin command names, followed by an array of
their corresponding functions.  This is so that, in the future, builtin commands
can be added simply by modifying these arrays, rather than editing a large
“switch” statement somewhere in the code.  If you’re confused by the declaration
of <code class="highlighter-rouge">builtin_func</code>, that’s OK!  I am too.  It’s an array of function pointers
(that take array of strings and return an int).  Any declaration involving
function pointers in C can get really complicated.  I still look up how function
pointers are declared myself!</p>

<p>Finally, I implement each function.  The <code class="highlighter-rouge">lsh_cd()</code> function first checks that
its second argument exists, and prints an error message if it doesn’t.  Then, it
calls <code class="highlighter-rouge">chdir()</code>, checks for errors, and returns.  The help function prints a
nice message and the names of all the builtins.  And the exit function returns
0, as a signal for the command loop to terminate.</p>

<h2 id="putting-together-builtins-and-processes">Putting together builtins and processes</h2>

<p>The last missing piece of the puzzle is to implement <code class="highlighter-rouge">lsh_execute()</code>, the
function that will either launch either a builtin, or a process.  If you’re
reading this far, you’ll know that we’ve set ourselves up for a really simple
function:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">lsh_execute</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// An empty command was entered.
</span>    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lsh_num_builtins</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">builtin_str</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">builtin_func</span><span class="p">[</span><span class="n">i</span><span class="p">])(</span><span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">lsh_launch</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>All this does is check if the command equals each builtin, and if so, run it.
If it doesn’t match a builtin, it calls <code class="highlighter-rouge">lsh_launch()</code> to launch the process.
The one caveat is that <code class="highlighter-rouge">args</code> might just contain NULL, if the user entered an
empty string, or just whitespace.  So, we need to check for that case at the
beginning.</p>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>That’s all the code that goes into the shell.  If you’ve read along, you should
understand completely how the shell works.  To try it out (on a Linux machine),
you would need to copy these code segments into a file (<code class="highlighter-rouge">main.c</code>), and compile
it.  Make sure to only include one implementation of <code class="highlighter-rouge">lsh_read_line()</code>.  You’ll
need to include the following headers at the top.  I’ve added notes so that you
know where each function comes from.</p>

<ul>
  <li><code class="highlighter-rouge">#include &lt;sys/wait.h&gt;</code>
    <ul>
      <li><code class="highlighter-rouge">waitpid()</code> and associated macros</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">#include &lt;unistd.h&gt;</code>
    <ul>
      <li><code class="highlighter-rouge">chdir()</code></li>
      <li><code class="highlighter-rouge">fork()</code></li>
      <li><code class="highlighter-rouge">exec()</code></li>
      <li><code class="highlighter-rouge">pid_t</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">#include &lt;stdlib.h&gt;</code>
    <ul>
      <li><code class="highlighter-rouge">malloc()</code></li>
      <li><code class="highlighter-rouge">realloc()</code></li>
      <li><code class="highlighter-rouge">free()</code></li>
      <li><code class="highlighter-rouge">exit()</code></li>
      <li><code class="highlighter-rouge">execvp()</code></li>
      <li><code class="highlighter-rouge">EXIT_SUCCESS</code>, <code class="highlighter-rouge">EXIT_FAILURE</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">#include &lt;stdio.h&gt;</code>
    <ul>
      <li><code class="highlighter-rouge">fprintf()</code></li>
      <li><code class="highlighter-rouge">printf()</code></li>
      <li><code class="highlighter-rouge">stderr</code></li>
      <li><code class="highlighter-rouge">getchar()</code></li>
      <li><code class="highlighter-rouge">perror()</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">#include &lt;string.h&gt;</code>
    <ul>
      <li><code class="highlighter-rouge">strcmp()</code></li>
      <li><code class="highlighter-rouge">strtok()</code></li>
    </ul>
  </li>
</ul>

<p>Once you have the code and headers, it should be as simple as running <code class="highlighter-rouge">gcc -o
main main.c</code> to compile it, and then <code class="highlighter-rouge">./main</code> to run it.</p>

<p>Alternatively, you can get the code from
<a href="https://github.com/brenns10/lsh/tree/407938170e8b40d231781576e05282a41634848c">GitHub</a>.
That link goes straight to the current revision of the code at the time of this
writing– I may choose to update it and add new features someday in the future.
If I do, I’ll try my best to update this article with the details and
implementation ideas.</p>

<h2 id="wrap-up">Wrap up</h2>

<p>If you read this and wondered how in the world I knew how to use those system
calls, the answer is simple: man pages.  In <code class="highlighter-rouge">man 3p</code> there is thorough
documentation on every system call.  If you know what you’re looking for, and
you just want to know how to use it, the man pages are your best friend.  If you
don’t know what sort of interface the C library and Unix offer you, I would
point you toward the
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/">POSIX Specification</a>,
specifically Section 13, “Headers”.  You can find each header and everything it
is required to define in there.</p>

<p>Obviously, this shell isn’t feature-rich.  Some of its more glaring omissions
are:</p>

<ul>
  <li>Only whitespace separating arguments, no quoting or backslash escaping.</li>
  <li>No piping or redirection.</li>
  <li>Few standard builtins.</li>
  <li>No globbing.</li>
</ul>

<p>The implementation of all of this stuff is really interesting, but way more than
I could ever fit into an article like this.  If I ever get around to
implementing any of them, I’ll be sure to write a follow-up about it.  But I’d
encourage any reader to try implementing this stuff yourself.  If you’re met
with success, drop me a line in the comments below, I’d love to see the code.</p>

<p>And finally, thanks for reading this tutorial (if anyone did).  I enjoyed
writing it, and I hope you enjoyed reading it.  Let me know what you think in
the comments!</p>

<p><strong>Edit:</strong> In an earlier version of this article, I had a couple nasty bugs in
<code class="highlighter-rouge">lsh_split_line()</code>, that just happened to cancel each other out.  Thanks to
/u/munmap on Reddit (and other commenters) for catching them!  Check
<a href="https://github.com/brenns10/lsh/commit/486ec6dcdd1e11c6dc82f482acda49ed18be11b5">this diff</a>
to see exactly what I did wrong.</p>

<p><strong>Edit 2:</strong> Thanks to user ghswa on GitHub for contributing some null checks for
  <code class="highlighter-rouge">malloc()</code> that I forgot.  He/she also pointed out that the
  <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/getline.html">manpage</a>
  for <code class="highlighter-rouge">getline()</code> specifies that the first argument should be freeable, so
  <code class="highlighter-rouge">line</code> should be initialized to <code class="highlighter-rouge">NULL</code> in my <code class="highlighter-rouge">lsh_read_line()</code> implementation
  that uses <code class="highlighter-rouge">getline()</code>.</p>


<div class="social">
  <ul>
    <li><div class="fb-like fb_iframe_widget" data-href="/2015/01/16/write-a-shell-in-c/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true" fb-xfbml-state="rendered" fb-iframe-plugin-query="action=like&amp;app_id=&amp;container_width=0&amp;href=https%3A%2F%2Fbrennan.io%2F2015%2F01%2F16%2Fwrite-a-shell-in-c%2F&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;share=true&amp;show_faces=true"><span style="vertical-align: bottom; width: 118px; height: 20px;"><iframe name="f2ee22191576b44" width="1000px" height="1000px" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="fb:like Facebook Social Plugin" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/like.html" style="border: none; visibility: visible; width: 118px; height: 20px;" class=""></iframe></span></div>
</li>
    <li><iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" title="Twitter Tweet Button" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/tweet_button.64457a6e8f493e1f1022f50e4e7e67e8.en.html" style="position: static; visibility: visible; width: 60px; height: 20px;"></iframe>
</li>
    <li><iframe src="./Tutorial - Write a Shell in C • Stephen Brennan_files/saved_resource.html" name="hn-button-abpgrep" id="hn-button-abpgrep" class="hn-button" data-title="Tutorial - Write a Shell in C • Stephen Brennan" data-url="https://brennan.io/2015/01/16/write-a-shell-in-c/" data-count="horizontal" title="Hacker News Button" height="20" width="82" frameborder="0"></iframe>
</li>
    <li id="reddit-share"><script type="text/javascript" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/button1.js.téléchargé"></script><iframe src="./Tutorial - Write a Shell in C • Stephen Brennan_files/button1.html" height="22" width="120" scrolling="no" frameborder="0"></iframe>
</li>
  </ul>
</div>
<hr>


<div id="disqus_thread"><iframe id="dsq-app251" name="dsq-app251" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/saved_resource(1).html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 8070px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
<script>

 /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
 var disqus_config = function () {
     this.page.url = "https://brennan.io/2015/01/16/write-a-shell-in-c/";  // Replace PAGE_URL with your page's canonical URL variable
 };
 (function() { // DON'T EDIT BELOW THIS LINE
     var d = document, s = d.createElement('script');
     s.src = '//stephenbrennan.disqus.com/embed.js';
     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the &lt;a href="https://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>



</div>


  <div style="clear:both;"></div>
  <div class="poweredby">
      <a href="https://brennan.io/legal">Legal</a> •
      <a href="https://brennan.io/blog/rss.xml">RSS</a>
      <br><br>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/88x31.png"></a>
      <br><br>
      <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Stephen Brennan's Blog</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
  </div>
  

<div class="igtranslator-main-div"><iframe src="./Tutorial - Write a Shell in C • Stephen Brennan_files/saved_resource(2).html" class="igtranslator-iframe" scrolling="no" frameborder="0"></iframe></div><div class="igtranslator-activator-icon bounceIn" style="background-image: url(chrome-extension://jgnebchahhepphmokjeohhoebakpfggp/data/icons/home.png)" title="Click to Show Translation"></div><iframe style="display: none;" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/saved_resource(3).html"></iframe><iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;" title="Twitter analytics iframe" src="./Tutorial - Write a Shell in C • Stephen Brennan_files/saved_resource(4).html"></iframe></body></html>